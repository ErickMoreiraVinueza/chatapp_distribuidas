# ğŸ—ï¸ Arquitectura del Sistema - ChatApp

## Ãndice
- [Arquitectura General](#arquitectura-general)
- [Diagrama de Componentes](#diagrama-de-componentes)
- [Diagrama de Despliegue](#diagrama-de-despliegue)
- [Flujo de Datos](#flujo-de-datos)
- [Patrones de DiseÃ±o](#patrones-de-diseÃ±o)

---

## Arquitectura General

El sistema sigue una arquitectura **Cliente-Servidor con comunicaciÃ³n bidireccional**, dividida en tres capas principales:

### Capa de PresentaciÃ³n (Frontend)
- **Framework**: React 18.3 con Hooks
- **Build Tool**: Vite (HMR, ESM)
- **Estado**: Local state (useState) + Context API implÃ­cito
- **ComunicaciÃ³n**:
  - REST API (Axios) para operaciones CRUD
  - WebSockets (Socket.IO Client) para tiempo real

### Capa de LÃ³gica (Backend)
- **Runtime**: Node.js v18+
- **Framework Web**: Express.js
- **WebSockets**: Socket.IO Server
- **Arquitectura**: MVC (Model-View-Controller)
- **Middleware**: JWT Auth, Multer Upload, CORS

### Capa de Persistencia
- **Base de Datos**: MongoDB (NoSQL)
- **ODM**: Mongoose
- **Almacenamiento de Archivos**: Sistema de archivos local (`/uploads`)

---

## Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            FRONTEND (React)                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                         Componentes UI                                   â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚   Login      â”‚ â”‚   Register   â”‚ â”‚  AdminLogin  â”‚ â”‚  Dashboard   â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚ â”‚
â”‚ â”‚ â”‚  ChatRoom    â”‚ â”‚  AdminPanel  â”‚ â”‚RoomMessages  â”‚                     â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                        Capa de Servicios                                 â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚ â”‚ â”‚     Socket.IO Client        â”‚  â”‚        Axios HTTP           â”‚       â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ connect()                â”‚  â”‚  â€¢ GET/POST/PUT/DELETE      â”‚       â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ emit(event, data)        â”‚  â”‚  â€¢ Headers (Authorization)  â”‚       â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ on(event, callback)      â”‚  â”‚  â€¢ Interceptors             â”‚       â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ disconnect()             â”‚  â”‚  â€¢ Error handling           â”‚       â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                    WebSocket (ws://)â”‚HTTP (REST API)
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BACKEND (Node.js + Express)                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                     Socket.IO Server (WebSocket)                         â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚  Event Handlers                                                    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ connection       â†’ Nuevo cliente conectado                      â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ joinRoom         â†’ Usuario entra a sala (valida sesiÃ³n Ãºnica)   â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ sendMessage      â†’ Enviar mensaje (broadcast a sala)            â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ editMessage      â†’ Editar mensaje existente                     â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ deleteMessage    â†’ Eliminar mensaje                             â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ kickUser         â†’ Expulsar usuario (admin)                     â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ userActivity     â†’ Actualizar lastActivity (heartbeat)          â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ disconnect       â†’ Cliente desconectado (cleanup)               â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚  Estado en Memoria                                                 â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ userSessions = { nickname: { socketId, roomId, lastActivity } } â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ kickedUsers = { roomId: [nickname1, nickname2, ...] }           â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚  Sistemas Automatizados                                            â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ setInterval() â†’ Revisa inactividad cada 30s                     â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ setInterval() â†’ Log de sesiones cada 60s                        â”‚   â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ Timeout: 5 minutos sin actividad â†’ disconnect                   â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                            REST API Routes                               â”‚ â”‚
â”‚ â”‚ /api/auth              /api/rooms             /api/messages              â”‚ â”‚
â”‚ â”‚   POST /register         GET /                  GET /:roomId             â”‚ â”‚
â”‚ â”‚   POST /login            POST /create           POST /                   â”‚ â”‚
â”‚ â”‚   GET /me                PUT /:id               PUT /:id                 â”‚ â”‚
â”‚ â”‚                          DELETE /:id            DELETE /:id              â”‚ â”‚
â”‚ â”‚                                                                           â”‚ â”‚
â”‚ â”‚ /api/admin             /api/files             /api/users                 â”‚ â”‚
â”‚ â”‚   GET /rooms             POST /upload           GET /room/:roomId        â”‚ â”‚
â”‚ â”‚   POST /rooms/kick       GET /:filename         POST /kick               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                            Controllers                                   â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚ â”‚ â”‚authCtrl     â”‚ â”‚roomCtrl     â”‚ â”‚messageCtrl  â”‚ â”‚fileCtrl     â”‚       â”‚ â”‚
â”‚ â”‚ â”‚â€¢ register   â”‚ â”‚â€¢ create     â”‚ â”‚â€¢ send       â”‚ â”‚â€¢ upload     â”‚       â”‚ â”‚
â”‚ â”‚ â”‚â€¢ login      â”‚ â”‚â€¢ getAll     â”‚ â”‚â€¢ getByRoom  â”‚ â”‚â€¢ serve      â”‚       â”‚ â”‚
â”‚ â”‚ â”‚â€¢ getMe      â”‚ â”‚â€¢ update     â”‚ â”‚â€¢ edit       â”‚ â”‚             â”‚       â”‚ â”‚
â”‚ â”‚ â”‚             â”‚ â”‚â€¢ delete     â”‚ â”‚â€¢ delete     â”‚ â”‚             â”‚       â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                             Middleware                                   â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚ â”‚ â”‚  authMiddleware.js  â”‚ â”‚    multer.js        â”‚ â”‚     cors.js      â”‚  â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ Verifica JWT     â”‚ â”‚  â€¢ 50MB limit       â”‚ â”‚  â€¢ Origin check  â”‚  â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ AÃ±ade req.user   â”‚ â”‚  â€¢ Type validation  â”‚ â”‚  â€¢ Credentials   â”‚  â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                         Modelos (Mongoose)                               â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚ â”‚ â”‚   Admin     â”‚ â”‚    Room     â”‚ â”‚   Message   â”‚ â”‚    User     â”‚       â”‚ â”‚
â”‚ â”‚ â”‚â€¢ username   â”‚ â”‚â€¢ name       â”‚ â”‚â€¢ content    â”‚ â”‚â€¢ nickname   â”‚       â”‚ â”‚
â”‚ â”‚ â”‚â€¢ password   â”‚ â”‚â€¢ type       â”‚ â”‚â€¢ sender     â”‚ â”‚â€¢ roomId     â”‚       â”‚ â”‚
â”‚ â”‚ â”‚â€¢ email      â”‚ â”‚â€¢ pin        â”‚ â”‚â€¢ roomId     â”‚ â”‚â€¢ joinedAt   â”‚       â”‚ â”‚
â”‚ â”‚ â”‚â€¢ fullName   â”‚ â”‚â€¢ createdBy  â”‚ â”‚â€¢ fileUrl    â”‚ â”‚             â”‚       â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                    â”‚                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                              Utilidades                                  â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚ â”‚ â”‚        jwt.js               â”‚  â”‚     pinGenerator.js         â”‚       â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ generateToken(payload)   â”‚  â”‚  â€¢ Genera PINs aleatorios   â”‚       â”‚ â”‚
â”‚ â”‚ â”‚  â€¢ verifyToken(token)       â”‚  â”‚  â€¢ 4 dÃ­gitos Ãºnicos         â”‚       â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CAPA DE PERSISTENCIA                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                           MongoDB Database                               â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ â”‚
â”‚ â”‚ â”‚  admins     â”‚ â”‚   rooms     â”‚ â”‚  messages   â”‚ â”‚   users     â”‚       â”‚ â”‚
â”‚ â”‚ â”‚ Collection  â”‚ â”‚ Collection  â”‚ â”‚ Collection  â”‚ â”‚ Collection  â”‚       â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚                      File Storage (Local FS)                             â”‚ â”‚
â”‚ â”‚                           /uploads/                                       â”‚ â”‚
â”‚ â”‚  â€¢ ImÃ¡genes (jpg, png, gif, webp, svg)                                   â”‚ â”‚
â”‚ â”‚  â€¢ Videos (mp4, webm, mov)                                                â”‚ â”‚
â”‚ â”‚  â€¢ Documentos (pdf, doc, docx, xls, xlsx)                                â”‚ â”‚
â”‚ â”‚  â€¢ Audio (mp3, wav, ogg)                                                  â”‚ â”‚
â”‚ â”‚  â€¢ Comprimidos (zip, rar, 7z)                                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Diagrama de Despliegue

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLIENTE (Browser)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  React App (HTML + CSS + JavaScript Bundle)            â”‚  â”‚
â”‚  â”‚  â€¢ Vite Dev Server (dev): http://localhost:5173        â”‚  â”‚
â”‚  â”‚  â€¢ Build estÃ¡tico (prod): nginx/Apache                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ HTTP/WebSocket
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVIDOR DE APLICACIÃ“N                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Node.js + Express + Socket.IO                         â”‚  â”‚
â”‚  â”‚  â€¢ Puerto: 4000 (configurable)                         â”‚  â”‚
â”‚  â”‚  â€¢ Process Manager: PM2 (producciÃ³n)                   â”‚  â”‚
â”‚  â”‚  â€¢ Logs: stdout/stderr â†’ logs/                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Almacenamiento de Archivos                            â”‚  â”‚
â”‚  â”‚  â€¢ /uploads/ (local filesystem)                        â”‚  â”‚
â”‚  â”‚  â€¢ Alternativa (prod): AWS S3, Cloudinary, etc.        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ MongoDB Protocol
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SERVIDOR DE BASE DE DATOS                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  MongoDB v6.x+                                          â”‚  â”‚
â”‚  â”‚  â€¢ Puerto: 27017 (default)                             â”‚  â”‚
â”‚  â”‚  â€¢ Opciones:                                            â”‚  â”‚
â”‚  â”‚    - Local: mongod                                      â”‚  â”‚
â”‚  â”‚    - Cloud: MongoDB Atlas                              â”‚  â”‚
â”‚  â”‚  â€¢ ReplicaciÃ³n: Opcional (producciÃ³n)                  â”‚  â”‚
â”‚  â”‚  â€¢ Backup: Scheduled snapshots                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Despliegue en ProducciÃ³n

**OpciÃ³n 1: Servidor Ãšnico (MonolÃ­tico)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       VPS/Cloud Instance         â”‚
â”‚   (DigitalOcean, AWS EC2, etc.)  â”‚
â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Nginx (Reverse Proxy)     â”‚ â”‚
â”‚  â”‚  â€¢ :80 â†’ Frontend (static) â”‚ â”‚
â”‚  â”‚  â€¢ :443 â†’ Frontend (SSL)   â”‚ â”‚
â”‚  â”‚  â€¢ /api â†’ Backend :4000    â”‚ â”‚
â”‚  â”‚  â€¢ /socket.io â†’ WS :4000   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PM2 (Process Manager)     â”‚ â”‚
â”‚  â”‚  â€¢ Backend Node.js         â”‚ â”‚
â”‚  â”‚  â€¢ Auto-restart on crash   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MongoDB (Local)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**OpciÃ³n 2: Microservicios (Escalable)**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Vercel/       â”‚      â”‚   Heroku/       â”‚      â”‚  MongoDB Atlas  â”‚
â”‚   Netlify       â”‚      â”‚   Railway       â”‚      â”‚   (Cloud DB)    â”‚
â”‚                 â”‚      â”‚                 â”‚      â”‚                 â”‚
â”‚  Frontend       â”‚â”€â”€â”€â”€â”€â”€â”‚  Backend API +  â”‚â”€â”€â”€â”€â”€â”€â”‚  Database       â”‚
â”‚  (React Build)  â”‚      â”‚  Socket.IO      â”‚      â”‚  (Replica Set)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚   AWS S3 /      â”‚
                         â”‚   Cloudinary    â”‚
                         â”‚                 â”‚
                         â”‚  File Storage   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Datos

### 1. AutenticaciÃ³n de Admin

```
[Admin] â”€â”€(1)â”€â”€> [Frontend: Login.jsx]
                      â”‚
                      â”‚ (2) POST /api/auth/login
                      â”‚     { username, password }
                      â–¼
             [Backend: authController.js]
                      â”‚
                      â”‚ (3) Buscar en DB
                      â–¼
             [MongoDB: admins collection]
                      â”‚
                      â”‚ (4) Usuario encontrado
                      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                      â”‚
                      â”‚ (5) bcrypt.compare(password, hash)
                      â”‚
                      â”‚ (6) generateToken({ id, username })
                      â”‚
                      â”‚ (7) { token, admin: {...} }
                      â–¼
             [Frontend: localStorage]
                      â”‚
                      â”‚ (8) Guardar token
                      â”‚
                      â–¼
             [Dashboard renderizado]
```

### 2. CreaciÃ³n de Sala

```
[Admin] â”€â”€(1)â”€â”€> [Dashboard: Formulario]
                      â”‚
                      â”‚ (2) POST /api/rooms/create
                      â”‚     Headers: { Authorization: Bearer <token> }
                      â”‚     Body: { name, type, pin? }
                      â–¼
             [authMiddleware: Verificar JWT]
                      â”‚
                      â”‚ (3) Token vÃ¡lido â†’ req.user = decoded
                      â–¼
             [roomController.create]
                      â”‚
                      â”‚ (4) Generar PIN si no existe
                      â”‚     pinGenerator.generate()
                      â”‚
                      â”‚ (5) new Room({ name, type, pin, createdBy })
                      â–¼
             [MongoDB: rooms.save()]
                      â”‚
                      â”‚ (6) Sala guardada con _id
                      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                      â”‚
                      â”‚ (7) io.emit('roomCreated', room)
                      â”‚     Broadcast a todos los clientes
                      â–¼
             [Todos los Frontends]
                      â”‚
                      â”‚ (8) Actualizar lista de salas
                      â–¼
             [Dashboard: Salas actualizadas]
```

### 3. Usuario Entra a Sala (Con Control de SesiÃ³n)

```
[Usuario] â”€â”€(1)â”€â”€> [ChatRoom: Formulario PIN]
                      â”‚
                      â”‚ (2) socket.emit('joinRoom')
                      â”‚     { nickname, roomId }
                      â–¼
             [Socket.IO Server: 'joinRoom' handler]
                      â”‚
                      â”‚ (3) Verificar si estÃ¡ en lista negra
                      â”‚     if (kickedUsers[roomId].includes(nickname))
                      â”‚        â†’ emit('kicked')
                      â”‚        â†’ return
                      â”‚
                      â”‚ (4) Verificar sesiÃ³n existente
                      â”‚     if (userSessions[nickname])
                      â”‚        â†’ Desconectar socket anterior
                      â”‚        â†’ emit('sessionReplaced') al socket viejo
                      â”‚        â†’ Remover de sala anterior
                      â”‚
                      â”‚ (5) Registrar nueva sesiÃ³n
                      â”‚     userSessions[nickname] = {
                      â”‚       socketId: socket.id,
                      â”‚       roomId,
                      â”‚       lastActivity: Date.now()
                      â”‚     }
                      â”‚
                      â”‚ (6) socket.join(roomId)
                      â”‚
                      â”‚ (7) Buscar mensajes de la sala
                      â–¼
             [MongoDB: messages.find({ roomId })]
                      â”‚
                      â”‚ (8) Mensajes encontrados
                      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                      â”‚
                      â”‚ (9) socket.emit('loadMessages', messages)
                      â”‚     Solo al usuario que entrÃ³
                      â”‚
                      â”‚ (10) io.to(roomId).emit('userJoined')
                      â”‚      Notificar a todos en la sala
                      â–¼
             [ChatRoom: Renderizar mensajes]
```

### 4. EnvÃ­o de Mensaje en Tiempo Real

```
[Usuario] â”€â”€(1)â”€â”€> [ChatRoom: Input de mensaje]
                      â”‚
                      â”‚ (2) socket.emit('sendMessage')
                      â”‚     { roomId, nickname, content, fileUrl? }
                      â–¼
             [Socket.IO: 'sendMessage' handler]
                      â”‚
                      â”‚ (3) Actualizar actividad
                      â”‚     userSessions[nickname].lastActivity = Date.now()
                      â”‚
                      â”‚ (4) new Message({ roomId, sender, content, fileUrl })
                      â–¼
             [MongoDB: messages.save()]
                      â”‚
                      â”‚ (5) Mensaje guardado con _id y timestamp
                      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                      â”‚
                      â”‚ (6) io.to(roomId).emit('newMessage', message)
                      â”‚     Broadcast a TODOS en la sala (incluyendo emisor)
                      â–¼
             [Todos los ChatRoom en esa sala]
                      â”‚
                      â”‚ (7) AÃ±adir mensaje al estado
                      â”‚     setMessages(prev => [...prev, message])
                      â”‚
                      â–¼
             [UI actualizada en tiempo real]
```

### 5. Sistema de Inactividad

```
[Servidor inicia] â”€â”€> setInterval(checkInactivity, 30000)
                              â”‚
                              â”‚ Cada 30 segundos:
                              â”‚
                              â–¼
                    [Iterar userSessions]
                              â”‚
                              â”‚ Para cada sesiÃ³n:
                              â”‚   inactiveTime = now - lastActivity
                              â”‚
                              â”‚   if (inactiveTime > 5 minutos):
                              â–¼
                    [Desconectar usuario]
                              â”‚
                              â”‚ (1) socket.emit('inactivityDisconnect')
                              â”‚
                              â”‚ (2) socket.leave(roomId)
                              â”‚
                              â”‚ (3) delete userSessions[nickname]
                              â”‚
                              â”‚ (4) io.to(roomId).emit('userLeft', nickname)
                              â”‚
                              â–¼
                    [Frontend: Mostrar overlay]
                              â”‚
                              â”‚ "â° Desconectado por inactividad"
                              â”‚
                              â–¼
                    [Redirigir a home despuÃ©s de 3s]
```

**Heartbeat del Cliente:**
```
[ChatRoom montado] â”€â”€> useEffect(() => {
                           setInterval(() => {
                             socket.emit('userActivity')
                           }, 120000)  // Cada 2 minutos
                       }, [])
                              â”‚
                              â”‚ Cada 2 minutos:
                              â–¼
                    [Socket.IO: 'userActivity' handler]
                              â”‚
                              â”‚ Actualizar timestamp:
                              â”‚ userSessions[nickname].lastActivity = Date.now()
                              â”‚
                              â–¼
                    [SesiÃ³n se mantiene activa]
```

### 6. Subida de Archivo Multimedia

```
[Usuario] â”€â”€(1)â”€â”€> [ChatRoom: Click en botÃ³n archivo]
                      â”‚
                      â”‚ (2) <input type="file" onChange />
                      â”‚
                      â”‚ (3) Seleccionar archivo
                      â”‚
                      â”‚ (4) FormData.append('file', file)
                      â–¼
             [axios.post('/api/files/upload')]
                      â”‚
                      â”‚ Headers: { Content-Type: multipart/form-data }
                      â–¼
             [Multer Middleware]
                      â”‚
                      â”‚ (5) Validar:
                      â”‚     - TamaÃ±o < 50MB
                      â”‚     - Tipo permitido
                      â”‚
                      â”‚ (6) Guardar en /uploads/
                      â”‚     filename = timestamp + originalname
                      â–¼
             [File System: /uploads/filename.ext]
                      â”‚
                      â”‚ (7) Respuesta:
                      â”‚     { fileUrl: '/api/files/filename.ext' }
                      â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
                      â”‚
                      â”‚ (8) socket.emit('sendMessage', {
                      â”‚       content: '',
                      â”‚       fileUrl: '/api/files/filename.ext'
                      â”‚     })
                      â–¼
             [Flujo normal de mensaje]
                      â”‚
                      â–¼
             [ChatRoom: Renderizar segÃºn tipo]
                      â”‚
                      â”œâ”€> Si es imagen: <img src={fileUrl} />
                      â”œâ”€> Si es video: <video src={fileUrl} controls />
                      â””â”€> Si es otro: <a href={fileUrl} download />
```

---

## Patrones de DiseÃ±o

### 1. **MVC (Model-View-Controller)**

- **Model**: Mongoose schemas (`User`, `Room`, `Message`, `Admin`)
- **View**: React components (JSX)
- **Controller**: Express controllers (`authController`, `roomController`, etc.)

**Beneficios:**
- SeparaciÃ³n de responsabilidades
- FÃ¡cil mantenimiento
- Testeo independiente de cada capa

### 2. **Observer Pattern (Pub/Sub)**

Implementado con Socket.IO:

```javascript
// Publisher (Server)
io.to(roomId).emit('newMessage', message);

// Subscriber (Client)
socket.on('newMessage', (message) => {
  setMessages(prev => [...prev, message]);
});
```

**Beneficios:**
- ComunicaciÃ³n en tiempo real
- Desacoplamiento entre componentes
- Broadcast eficiente

### 3. **Middleware Pattern**

```javascript
app.use(authMiddleware); // ValidaciÃ³n JWT
app.use(multer.upload);  // Procesamiento de archivos
app.use(cors());         // CORS headers
```

**Beneficios:**
- LÃ³gica reutilizable
- Pipeline de procesamiento
- InterceptaciÃ³n de requests

### 4. **Repository Pattern** (implÃ­cito con Mongoose)

```javascript
class RoomRepository {
  async findAll() { return await Room.find(); }
  async findById(id) { return await Room.findById(id); }
  async create(data) { return await Room.create(data); }
}
```

**Beneficios:**
- AbstracciÃ³n de la capa de datos
- Facilita testing (mocking)
- Cambio de DB sin afectar lÃ³gica

### 5. **Singleton Pattern**

```javascript
// Socket.IO instance (Ãºnica en todo el servidor)
const io = new Server(server);

// MongoDB connection (Ãºnica instancia)
mongoose.connect(process.env.MONGODB_URI);
```

**Beneficios:**
- Ãšnica conexiÃ³n a DB
- GestiÃ³n centralizada de recursos
- Evita mÃºltiples instancias

---

## ComunicaciÃ³n entre Componentes

### REST API vs WebSockets

| OperaciÃ³n | Protocolo | RazÃ³n |
|-----------|-----------|-------|
| Login/Register | REST | OperaciÃ³n Ãºnica, no requiere tiempo real |
| Crear/Editar/Eliminar Sala | REST | CRUD estÃ¡ndar |
| Unirse a Sala | WebSocket | Requiere estado de conexiÃ³n persistente |
| Enviar Mensaje | WebSocket | Tiempo real, broadcast a mÃºltiples clientes |
| Editar/Eliminar Mensaje | WebSocket | ActualizaciÃ³n en tiempo real para todos |
| Subir Archivo | REST | HTTP Multipart, mÃ¡s adecuado que WS |
| Expulsar Usuario | WebSocket | DesconexiÃ³n forzada en tiempo real |
| Heartbeat | WebSocket | Mantener conexiÃ³n activa |

---

## Escalabilidad

### Limitaciones Actuales

1. **Estado en Memoria** (`userSessions`, `kickedUsers`)
   - Problema: Se pierde al reiniciar servidor
   - SoluciÃ³n: Redis para estado distribuido

2. **Socket.IO sin Adaptador**
   - Problema: No funciona con mÃºltiples instancias
   - SoluciÃ³n: Socket.IO Redis Adapter

3. **Archivos en File System Local**
   - Problema: No escalable horizontalmente
   - SoluciÃ³n: AWS S3, Cloudinary, Google Cloud Storage

4. **MongoDB Ãšnica Instancia**
   - Problema: Punto Ãºnico de fallo
   - SoluciÃ³n: Replica Set o MongoDB Atlas

### Arquitectura Escalable (Propuesta)

```
                    [Load Balancer]
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
   [Node.js #1]      [Node.js #2]      [Node.js #3]
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                    [Redis Cluster]
                    (userSessions)
                          â”‚
                 [MongoDB Replica Set]
                          â”‚
                    [S3 / CDN]
                  (Static Files)
```

---

## Seguridad en Arquitectura

### Capas de Seguridad

1. **Transporte**: HTTPS/WSS (TLS)
2. **AutenticaciÃ³n**: JWT con expiraciÃ³n
3. **AutorizaciÃ³n**: Middleware por endpoint
4. **ValidaciÃ³n**: Input sanitization
5. **CORS**: Whitelist de orÃ­genes
6. **Rate Limiting**: Prevenir DDoS
7. **File Upload**: Tipo y tamaÃ±o validados

---

**Ãšltima actualizaciÃ³n:** Noviembre 2025
